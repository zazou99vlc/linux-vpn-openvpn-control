Asistente de Conexi√≥n VPN (v97)

Un script en Python dise√±ado para gestionar conexiones OpenVPN de forma robusta, segura y totalmente desatendida. Disponible en Espa√±ol e Ingl√©s.

Este asistente automatiza todo el proceso de conexi√≥n, vigilancia y reparaci√≥n de la red, ideal para mantener tu privacidad sin tener que vigilar la ventana de comandos. Aunque la detecci√≥n de puerto est√° optimizada para la API de PrivateVPN, el resto de funcionalidades (conexi√≥n, kill-switch, DNS leak protection) funciona con cualquier proveedor que use archivos .ovpn.
¬øQu√© hace este script?
üõ°Ô∏è Seguridad y Privacidad

    Kill-Switch Inteligente: Si la VPN se cae y no puede reconectar, corta el tr√°fico de red inmediatamente para evitar exponer tu IP real.

    Blindaje IPv6: Bloquea totalmente el tr√°fico IPv6 (v√≠a Firewall y NetworkManager) para evitar fugas de identidad, ya que muchas VPNs solo protegen IPv4.

    Guardi√°n de Rutas (Route Guardian): NetworkManager a veces intenta "escapar" de la VPN creando rutas por defecto inseguras. Este script vigila la tabla de enrutamiento cada segundo y elimina cualquier fuga al instante.

    Gesti√≥n de DNS Anti-Leak: Configura autom√°ticamente las DNS para evitar fugas, soportando tanto systemd-resolved (Arch Linux/Manjaro) como la gesti√≥n est√°ndar de NetworkManager.

‚öôÔ∏è Automatizaci√≥n y Estabilidad

    Conexi√≥n "Roca": Si la conexi√≥n se pierde, el script lo detecta, limpia el entorno y reconecta autom√°ticamente.

    Script Post-Conexi√≥n: Puedes configurar un script externo (opcional) que se ejecutar√° autom√°ticamente cada vez que la VPN conecte o reconecte (ideal para actualizar puertos en Transmission/aMule).

    An√°lisis de Estabilidad: El script analiza si las desconexiones siguen un patr√≥n (ej. renovaci√≥n DHCP del router) y te avisa.

    Cifrado por Hardware: Tus credenciales se guardan cifradas vinculadas al ID f√≠sico de tu m√°quina. Si copian tu archivo de configuraci√≥n a otro PC, no funcionar√°.

üîå Utilidades

    Detecci√≥n de Puerto: (Solo PrivateVPN) Consulta la API para decirte qu√© puerto tienes abierto para P2P.

    Formateo de Nombres: Limpia los nombres de los archivos .ovpn para mostrarlos bonitos (ej: "[ES] Madrid" en lugar de "privatevpn-madrid-tun-443.ovpn").

Requisitos e Instalaci√≥n

El script est√° dise√±ado para ser ligero. Solo necesitas el script de Python y tus archivos .ovpn.

1. Dependencias del Sistema:
Necesitas herramientas b√°sicas de red.

    openvpn, curl, sudo, iptables, nmcli (NetworkManager).

2. Librer√≠as de Python:
El script usa requests y ping3.

    IMPORTANTE: Para ping3, se recomienda usar el gestor de paquetes de tu distribuci√≥n en lugar de pip, para evitar conflictos de permisos con sudo.

    Arch Linux / Manjaro:
    code Bash

    
sudo pacman -S openvpn curl python-requests
yay -S python-ping3

  

Debian / Ubuntu / Mint:
code Bash

    
sudo apt install openvpn curl python3-requests python3-ping3

  

Fedora:
code Bash

        
    sudo dnf install openvpn curl python3-requests python3-ping3

      

C√≥mo usarlo
1. Preparaci√≥n

Crea una carpeta y mete dentro:

    El script convpn97.py.

    Tus archivos .ovpn (tantos como quieras).

    (Opcional) Tu script .sh para actualizar puertos si lo usas.

2. Ejecuci√≥n

No necesitas abrir una terminal manualmente si no quieres. El script es capaz de detectar si se est√° ejecutando en segundo plano y abrir√° su propia ventana de terminal autom√°ticamente.

Puedes ejecutarlo de varias formas:

    Opci√≥n A (Recomendada): Ejecuta python3 convpn97.py

    Opci√≥n B: Dale permisos de ejecuci√≥n (chmod +x convpn97.py) y haz doble clic sobre √©l o ejec√∫talo como ./convpn97.py.

Al iniciar por primera vez, el asistente te guiar√°:

    Idioma: Selecciona Espa√±ol o Ingl√©s.

    Credenciales: Te pedir√° tu usuario y contrase√±a de la VPN. Se guardar√°n cifrados localmente.

    Formato de Nombres: Te preguntar√° c√≥mo quieres ver la lista de servidores (ej. Si prefieres ver "Pa√≠s - Ciudad" o solo "Ciudad").

3. Men√∫ de Configuraci√≥n (Tecla 'M')

En la pantalla de selecci√≥n de servidor, puedes pulsar 'M' para:

    Configurar Script Post-Conexi√≥n: Vincula un script (bash/python) para que se ejecute tras conectar. √ötil para actualizar clientes Torrent con el nuevo puerto.

    Crear/Actualizar Lanzador: Crea un acceso directo en tu men√∫ de aplicaciones.

        Nota: Si descargas una nueva versi√≥n del script, usa esta opci√≥n de nuevo. El script detectar√° los lanzadores antiguos, los borrar√° y crear√° uno nuevo apuntando a la versi√≥n correcta.

    Gestionar Credenciales: Por si cambias tu contrase√±a.

    Cambiar Idioma y Visualizaci√≥n.

Funcionamiento Detallado

    Inicio: El script verifica tu conexi√≥n actual y tu IP real.

    Conexi√≥n: Modifica temporalmente el perfil de red para evitar conflictos, lanza OpenVPN y espera a que se estabilice.

    Verificaci√≥n:

        Hace ping (usando ping3) para verificar conectividad.

        Comprueba que tu IP p√∫blica haya cambiado.

        Verifica que la ruta por defecto apunte a la VPN.

    Monitorizaci√≥n:

        Entra en un bucle donde vigila la conexi√≥n constantemente.

        Si detecta una ca√≠da o una fuga de ruta, activa el protocolo de reconexi√≥n.

        Si reconecta con √©xito, vuelve a lanzar tu script post-conexi√≥n (si lo tienes configurado).

Nota: Este script requiere privilegios de sudo para modificar rutas y firewall. Te pedir√° la contrase√±a al inicio y la mantendr√° activa mientras el script funcione.
